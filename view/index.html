<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRUD Escola - Alunos e Professores</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#3B82F6",
              secondary: "#10B981",
              danger: "#EF4444",
            },
          },
        },
      };
    </script>
    <style>
      .fade-in {
        animation: fadeIn 0.5s;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
    </style>
  </head>
  <body class="bg-gray-100 min-h-screen font-sans">
    <div class="container mx-auto px-4 py-8">
      <header class="text-center mb-12">
        <h1 class="text-4xl font-bold text-primary mb-2">Sistema Escolar</h1>
        <p class="text-gray-600">
          Gerencie alunos e professores de forma fácil e intuitiva
        </p>
      </header>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h2
            class="text-2xl font-semibold text-gray-800 mb-6 flex items-center"
          >
            <i class="fas fa-user-plus mr-3 text-primary"></i>
            <span id="formTitle">Adicionar Novo Registro</span>
          </h2>

          <form id="userForm" class="space-y-4">
            <div class="flex items-center mb-4 p-3 bg-blue-50 rounded-lg">
              <label class="inline-flex items-center cursor-pointer">
                <input type="checkbox" id="isProfessor" class="sr-only peer" />
                <div
                  class="relative w-11 h-6 bg-gray-200 peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-secondary"
                ></div>
                <span
                  class="ml-3 text-sm font-medium text-gray-900"
                  id="toggleLabel"
                  >Aluno</span
                >
              </label>
            </div>

            <div>
              <label
                for="nome"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Nome</label
              >
              <input
                type="text"
                id="nome"
                name="nome"
                required
                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition duration-200"
              />
            </div>

            <div>
              <label
                for="email"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Email</label
              >
              <input
                type="email"
                id="email"
                name="email"
                required
                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition duration-200"
              />
            </div>

            <div>
              <label
                for="idade"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Idade</label
              >
              <input
                type="number"
                id="idade"
                name="idade"
                min="1"
                required
                class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary transition duration-200"
              />
            </div>

            <input type="hidden" id="editId" value="" />
            <input type="hidden" id="editType" value="" />

            <div class="flex space-x-4 pt-4">
              <button
                type="submit"
                id="submitBtn"
                class="px-6 py-2 bg-primary text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-200 flex items-center"
              >
                <i class="fas fa-plus-circle mr-2"></i><span>Adicionar</span>
              </button>
              <button
                type="button"
                id="cancelEditBtn"
                class="hidden px-6 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition duration-200 flex items-center"
              >
                <i class="fas fa-times mr-2"></i><span>Cancelar</span>
              </button>
            </div>
          </form>

          <div id="statusMessage" class="mt-6 hidden p-4 rounded-lg"></div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-md">
          <h2
            class="text-2xl font-semibold text-gray-800 mb-6 flex items-center"
          >
            <i class="fas fa-list mr-3 text-primary"></i>Lista de Registros
          </h2>

          <div class="mb-6">
            <div class="flex space-x-4 bg-gray-100 p-2 rounded-lg">
              <button
                id="showAlunos"
                class="flex-1 px-4 py-2 bg-primary text-white rounded-md focus:outline-none transition duration-200 flex items-center justify-center"
              >
                <i class="fas fa-user-graduate mr-2"></i>Alunos
              </button>
              <button
                id="showProfessores"
                class="flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-green-500 hover:text-white focus:outline-none transition duration-200 flex items-center justify-center"
              >
                <i class="fas fa-chalkboard-teacher mr-2"></i>Professores
              </button>
            </div>
          </div>

          <div class="mb-4 flex justify-between items-center">
            <h3 class="text-lg font-medium text-gray-700" id="tableTitle">
              Alunos
            </h3>
            <div class="text-sm text-gray-500" id="totalItems">0 registros</div>
          </div>

          <div
            id="listaContainer"
            class="overflow-y-auto max-h-96 border border-gray-200 rounded-lg"
          >
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th
                    class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Nome
                  </th>
                  <th
                    class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Email
                  </th>
                  <th
                    class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Idade
                  </th>
                  <th
                    class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Tipo
                  </th>
                  <th
                    class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Ações
                  </th>
                </tr>
              </thead>
              <tbody
                id="listaRegistros"
                class="bg-white divide-y divide-gray-200"
              >
                <tr>
                  <td colspan="5" class="px-4 py-8 text-center text-gray-500">
                    <i
                      class="fas fa-spinner fa-spin text-2xl text-primary mb-2"
                    ></i>
                    <p>Carregando registros...</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script>
      let editingId = null;
      let currentType = "alunos";
      const API_BASE = "http://localhost:3000";

      const form = document.getElementById("userForm");
      const listaRegistros = document.getElementById("listaRegistros");
      const isProfessorCheckbox = document.getElementById("isProfessor");
      const toggleLabel = document.getElementById("toggleLabel");
      const submitBtn = document.getElementById("submitBtn");
      const cancelEditBtn = document.getElementById("cancelEditBtn");
      const showAlunosBtn = document.getElementById("showAlunos");
      const showProfessoresBtn = document.getElementById("showProfessores");
      const formTitle = document.getElementById("formTitle");
      const tableTitle = document.getElementById("tableTitle");
      const totalItems = document.getElementById("totalItems");
      const statusMessage = document.getElementById("statusMessage");
      const editIdField = document.getElementById("editId");
      const editTypeField = document.getElementById("editType");

      document.addEventListener("DOMContentLoaded", () => {
        carregarRegistros("alunos");
        form.addEventListener("submit", handleSubmit);
        cancelEditBtn.addEventListener("click", cancelEdit);
        showAlunosBtn.addEventListener("click", () =>
          carregarRegistros("alunos")
        );
        showProfessoresBtn.addEventListener("click", () =>
          carregarRegistros("professores")
        );
        isProfessorCheckbox.addEventListener("change", () => {
          toggleLabel.textContent = isProfessorCheckbox.checked
            ? "Professor"
            : "Aluno";
        });
      });

      function showStatus(message, isError = false) {
        statusMessage.textContent = message;
        statusMessage.className =
          "mt-6 p-4 rounded-lg " +
          (isError ? "bg-red-100 text-red-700" : "bg-green-100 text-green-700");
        statusMessage.classList.remove("hidden");
        setTimeout(() => statusMessage.classList.add("hidden"), 4000);
      }

      async function carregarRegistros(tipo) {
        currentType = tipo;
        listaRegistros.innerHTML = `<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">
          <i class="fas fa-spinner fa-spin text-2xl text-primary mb-2"></i>
          <p>Carregando registros...</p>
        </td></tr>`;
        try {
          const response = await fetch(`${API_BASE}/${tipo}`);
          if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
          const data = await response.json();

          if (tipo === "alunos") {
            showAlunosBtn.classList.replace("bg-gray-300", "bg-primary");
            showAlunosBtn.classList.replace("text-gray-700", "text-white");
            showProfessoresBtn.classList.replace("bg-secondary", "bg-gray-300");
            showProfessoresBtn.classList.replace("text-white", "text-gray-700");
            tableTitle.textContent = "Alunos";
          } else {
            showProfessoresBtn.classList.replace("bg-gray-300", "bg-secondary");
            showProfessoresBtn.classList.replace("text-gray-700", "text-white");
            showAlunosBtn.classList.replace("bg-primary", "bg-gray-300");
            showAlunosBtn.classList.replace("text-white", "text-gray-700");
            tableTitle.textContent = "Professores";
          }

          exibirRegistros(data, tipo);
        } catch (error) {
          console.error("Erro ao carregar registros:", error);
          listaRegistros.innerHTML = `<tr><td colspan="5" class="px-4 py-8 text-center text-red-500">
            <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
            <p>Erro ao carregar registros.</p>
            <p class="text-sm mt-2">Verifique se o servidor está rodando em ${API_BASE}</p>
          </td></tr>`;
          totalItems.textContent = "Erro ao carregar";
        }
      }

      function exibirRegistros(registros, tipo) {
        listaRegistros.innerHTML = "";
        if (registros.length === 0) {
          listaRegistros.innerHTML = `<tr><td colspan="5" class="px-4 py-8 text-center text-gray-500">
            <i class="fas fa-inbox text-2xl mb-2"></i>
            <p>Nenhum ${
              tipo === "alunos" ? "aluno" : "professor"
            } cadastrado.</p>
          </td></tr>`;
          totalItems.textContent = "0 registros";
          return;
        }

        registros.forEach((registro) => {
          const row = document.createElement("tr");
          row.className = "fade-in";
          row.innerHTML = `
            <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${
              registro.nome
            }</td>
            <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${
              registro.email
            }</td>
            <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">${
              registro.idade
            }</td>
            <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500">
              <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${
                tipo === "alunos"
                  ? "bg-blue-100 text-blue-800"
                  : "bg-green-100 text-green-800"
              }">${tipo === "alunos" ? "Aluno" : "Professor"}</span>
            </td>
            <td class="px-4 py-4 whitespace-nowrap text-sm font-medium">
              <button onclick="editarRegistro('${tipo}', ${
            registro.id
          })" class="text-blue-600 hover:text-blue-900 mr-3 transition duration-200" title="Editar">
                <i class="fas fa-edit"></i>
              </button>
              <button onclick="excluirRegistro('${tipo}', ${
            registro.id
          })" class="text-red-600 hover:text-red-900 transition duration-200" title="Excluir">
                <i class="fas fa-trash"></i>
              </button>
            </td>`;
          listaRegistros.appendChild(row);
        });

        totalItems.textContent = `${registros.length} ${
          registros.length === 1 ? "registro" : "registros"
        }`;
      }

      async function handleSubmit(e) {
        e.preventDefault();
        const formData = new FormData(form);
        const data = {
          nome: formData.get("nome"),
          email: formData.get("email"),
          idade: parseInt(formData.get("idade")),
        };
        try {
          let response, method, url, body;
          if (editingId) {
            method = "PUT";
            const tipo = editTypeField.value;
            url = `${API_BASE}/${tipo}/${editingId}`;
            body = new URLSearchParams({ nome: data.nome, email: data.email });
          } else {
            method = "POST";
            const tipo = isProfessorCheckbox.checked ? "professores" : "alunos";
            url = `${API_BASE}/${tipo}`;
            body = new URLSearchParams(data);
          }
          response = await fetch(url, {
            method,
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body,
          });
          if (response.ok) {
            showStatus(
              editingId
                ? "Registro atualizado com sucesso!"
                : "Registro criado com sucesso!"
            );
            form.reset();
            cancelEdit();
            carregarRegistros(currentType);
          } else {
            const error = await response.json();
            throw new Error(error.error || "Erro desconhecido");
          }
        } catch (error) {
          console.error("Erro ao salvar registro:", error);
          showStatus(`Erro: ${error.message}`, true);
        }
      }

      async function editarRegistro(tipo, id) {
        try {
          const response = await fetch(`${API_BASE}/${tipo}/${id}`);
          if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
          const data = await response.json();
          document.getElementById("nome").value = data.nome;
          document.getElementById("email").value = data.email;
          document.getElementById("idade").value = data.idade;
          editIdField.value = id;
          editTypeField.value = tipo;
          isProfessorCheckbox.checked = tipo === "professores";
          toggleLabel.textContent = isProfessorCheckbox.checked
            ? "Professor"
            : "Aluno";
          isProfessorCheckbox.disabled = true;
          editingId = id;
          submitBtn.innerHTML =
            '<i class="fas fa-save mr-2"></i><span>Atualizar</span>';
          formTitle.textContent = "Editar Registro";
          cancelEditBtn.classList.remove("hidden");
          document
            .querySelector(".bg-white.p-6.rounded-lg.shadow-md")
            .scrollIntoView({ behavior: "smooth" });
          showStatus(
            'Modo de edição ativado. Preencha os campos e clique em "Atualizar".'
          );
        } catch (error) {
          console.error("Erro ao carregar registro para edição:", error);
          showStatus("Erro ao carregar registro para edição.", true);
        }
      }

      async function excluirRegistro(tipo, id) {
        if (
          !confirm(
            "Tem certeza que deseja excluir este registro? Esta ação não pode ser desfeita."
          )
        )
          return;
        try {
          const response = await fetch(`${API_BASE}/${tipo}/${id}`, {
            method: "DELETE",
          });
          if (response.ok) {
            showStatus("Registro excluído com sucesso!");
            carregarRegistros(tipo);
          } else {
            const error = await response.json();
            throw new Error(error.error || "Erro ao excluir registro");
          }
        } catch (error) {
          console.error("Erro ao excluir registro:", error);
          showStatus(`Erro: ${error.message}`, true);
        }
      }

      function cancelEdit() {
        editingId = null;
        form.reset();
        submitBtn.innerHTML =
          '<i class="fas fa-plus-circle mr-2"></i><span>Adicionar</span>';
        formTitle.textContent = "Adicionar Novo Registro";
        cancelEditBtn.classList.add("hidden");
        isProfessorCheckbox.checked = false;
        isProfessorCheckbox.disabled = false;
        toggleLabel.textContent = "Aluno";
        editIdField.value = "";
        editTypeField.value = "";
        showStatus("Modo de edição cancelado.");
      }
    </script>
  </body>
</html>
